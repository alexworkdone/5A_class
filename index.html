<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Расписание - 5 класс</title>

    <link rel="stylesheet" href="css/owl.carousel.min.css" />
    <link rel="stylesheet" href="css/style.css" />
  </head>
  <body>
    <div class="container">
      <h1>Розклад уроків 5-A класу</h1>
      <div class="flex opacity65">
        <div class="table-day">
          <div class="item-day item-header">Номер уроку</div>
          <div id="less_1" class="item-day">
            <span id="time_start_1" class="time start">12:00</span>
            1 урок
            <span id="time_end_1" class="time end">12:45</span>
          </div>
          <div id="less_2" class="item-day">
            <span id="time_start_2" class="time start">12:55</span>
            2 урок
            <span id="time_end_2" class="time end">13:40</span>
          </div>
          <div id="less_3" class="item-day">
            <span id="time_start_3" class="time start">13:55</span>
            3 урок
            <span id="time_end_3" class="time end">14:40</span>
          </div>
          <div id="less_4" class="item-day">
            <span id="time_start_4" class="time start">14:50</span>
            4 урок
            <span id="time_end_4" class="time end">15:35</span>
          </div>
          <div id="less_5" class="item-day">
            <span id="time_start_5" class="time start">15:45</span>
            5 урок
            <span id="time_end_5" class="time end">16:30</span>
          </div>
          <div id="less_6" class="item-day">
            <span id="time_start_6" class="time start">16:35</span>
            6 урок
            <span id="time_end_6" class="time end">17:20</span>
          </div>
          <div id="less_7" class="item-day">
            <span id="time_start_7" class="time start">17:25</span>
            7 урок
            <span id="time_end_7" class="time end">18:10</span>
          </div>
        </div>
        <div class="owl-carousel table-slider">
          <div class="table-col" data-day="1">
            <div class="table-item item-header item-header-title">Понеділок</div>
            <div class="table-item">
              Інформатика
              <div class="name">Олександр Іванович</div>
            </div>
            <div class="table-item">
              Музичне мистецтво
              <div class="name">Богдана Миколаївна</div>
            </div>
            <div class="table-item">
              Математика
              <div class="name">Лідія Григорівна</div>
            </div>
            <div class="table-item">
              Українська література
              <div class="name">Інна Володимирівна</div>
            </div>
            <div class="table-item">
              Українська література
              <div class="name">Інна Володимирівна</div>
            </div>
            <div class="table-item">
              Основи здоров'я
              <div class="name">Олена Вікторівна</div>
            </div>
            <div class="table-item">---</div>
          </div>
          <div class="table-col" data-day="2">
            <div class="table-item item-header item-header-title">Вівторок</div>
            <div class="table-item">
              Фізична культура
              <div class="name">Ярослава Миколаївна</div>
            </div>
            <div class="table-item">
              Англійська мова
              <div class="name">Віта Андріївна</div>
            </div>
            <div class="table-item">
              Математика
              <div class="name">Лідія Григорівна</div>
            </div>
            <div class="table-item">
              Зарубіжна література
              <div class="name">Леся Павлівна</div>
            </div>
            <div class="table-item">
              Зарубіжна література
              <div class="name">Леся Павлівна</div>
            </div>
            <div class="table-item">
              Історія
              <div class="name">Сергій Олександрович</div>
            </div>
            <div class="table-item">---</div>
          </div>
          <div class="table-col" data-day="3">
            <div class="table-item item-header item-header-title">Середа</div>
            <div class="table-item">
              Українська мова
              <div class="name">Інна Володимирівна</div>
            </div>
            <div class="table-item">
              Образотворче мистецтво
              <div class="name">Інна Володимирівна</div>
            </div>
            <div class="table-item">
              Математика
              <div class="name">Лідія Григорівна</div>
            </div>
            <div class="table-item">
              Українська мова
              <div class="name">Інна Володимирівна</div>
            </div>
            <div class="table-item">
              Українська мова
              <div class="name">Інна Володимирівна</div>
            </div>
            <div class="table-item">
              Англійська мова
              <div class="name">Віта Андріївна</div>
            </div>
            <div class="table-item">---</div>
          </div>
          <div class="table-col" data-day="4">
            <div class="table-item item-header item-header-title">Четвер</div>
            <div class="table-item">
              Українська мова
              <div class="name">Інна Володимирівна</div>
            </div>
            <div class="table-item">
              Фізична культура
              <div class="name">Ярослава Миколаївна</div>
            </div>
            <div class="table-item">
              Трудове навчання
              <div class="name">Інна Володимирівна</div>
            </div>
            <div class="table-item">
              Математика
              <div class="name">Лідія Григорівна</div>
            </div>
            <div class="table-item">
              Англійська мова
              <div class="name">Віта Андріївна</div>
            </div>
            <div class="table-item">
              Російська мова
              <div class="name">Світлана Миколаївна</div>
            </div>
            <div class="table-item">
              Російська мова
              <div class="name">Світлана Миколаївна</div>
            </div>
          </div>
          <div class="table-col" data-day="5">
            <div class="table-item item-header item-header-title">П'ятниця</div>
            <div class="table-item">
              Природо<wbr />знавство
              <div class="name">Світлана Олексіївна</div>
            </div>
            <div class="table-item">
              Фізична культура
              <div class="name">Ярослава Миколаївна</div>
            </div>
            <div class="table-item">
              Природо<wbr />знавство
              <div class="name">Світлана Олексіївна</div>
            </div>
            <div class="table-item">
              Трудове навчання
              <div class="name">Інна Володимирівна</div>
            </div>
            <div class="table-item">Виховна година</div>
            <div class="table-item">---</div>
            <div class="table-item">---</div>
          </div>
        </div>
      </div>
    </div>

    <script src="js/jquery-3.3.1.min.js"></script>
    <script src="js/owl.carousel.min.js"></script>

    <script>
      $(document).ready(function () {
        var oneJan = new Date(new Date().getFullYear(), 0, 1);
        var numberOfDays = Math.floor((new Date() - oneJan) / (24 * 60 * 60 * 1000));
        var result = Math.ceil((new Date().getDay() + 6 + numberOfDays) / 7);

        console.log('result ->', result);

        const oddWeek = !(result % 2); // четная

        const arrTime = $("[id^='less']");

        const timeLesson = {
          start: ["11:00", "12:00", "12:55", "13:55", "14:50", "15:45", "16:35", "17:25"],
          end: ["11:45", "12:45", "13:40", "14:40", "15:35", "16:30", "17:20", "18:10"],
        };

        const carousel = $(".table-slider");

        function callBack(event) {
          setTimeout((item) => {
            let nameDay = $($(".owl-item.active")[0]).find(".item-header-title")[0].innerText;

            let nowTimeLesson = JSON.parse(JSON.stringify(timeLesson));

            switch (nameDay) {
              case "Середа":
                if (oddWeek) {
                  nowTimeLesson.start.pop();
                  nowTimeLesson.end.pop();
                  console.log('oddWeek Середа ->', nowTimeLesson);
                } else {
                  nowTimeLesson.start.shift();
                  nowTimeLesson.end.shift();
                  console.log('!oddWeek Середа ->', nowTimeLesson);
                }
                break;

              case "Четвер":
                nowTimeLesson.start.pop();
                nowTimeLesson.end.pop();
                break;

              default:
                nowTimeLesson.start.shift();
                nowTimeLesson.end.shift();
            }

            $.each(arrTime, (index, item) => {
              $(item).find("[id^='time_start']").html(nowTimeLesson.start[index]);
              $(item).find("[id^='time_end']").html(nowTimeLesson.end[index]);
            });

            drowFirstLesson();
          }, 100);
        }

        carousel.owlCarousel({
          loop: true,
          dots: false,
          merge: true,
          nav: false,
          stagePadding: 10,
          margin: 10,
          onInitialized: callBack,
          onChanged: callBack,
          responsive: {
            1200: {
              items: 5,
            },
            1000: {
              items: 4,
            },
            800: {
              items: 3,
            },
            600: {
              items: 2,
            },
            0: {
              items: 1,
            },
          },
        });

        const nowDay = new Date();
        const nowIndexDay = nowDay.getDay();
        const nowTime = nowDay.getTime();
        const nowHours = nowDay.getHours();
        const nowMinutes = nowDay.getMinutes();
        const LessonFinalTime = new Date().setHours(18, 10, 0, 0);

        // Проскроллить к расписанию сегодняшнего дня
        function scrollToDay(index) {
          carousel.trigger("to.owl.carousel", index);
        }

        let index = nowIndexDay >= 2 && nowIndexDay <= 5 ? nowIndexDay - 1 : 0;
        scrollToDay(index);

        // После инициализации назначить класс на сегодняшний день
        $(`[data-day='${nowIndexDay}']`).each((index, item) => {
          $(item)[0].classList.add("today_item");
        });

        // Закрасить все прошедшие уроки
        function endLessonToDay(itemStart, itemEnd, numLesson) {
          const [tsh, tsm] = $(itemStart).html().split(":");
          const [teh, tem] = $(itemEnd).html().split(":");

          const LessonStartTime = new Date().setHours(tsh, tsm, 0, 0);
          const LessonEndTime = new Date().setHours(teh, tem, 0, 0);

          if (LessonEndTime <= nowTime) {
            itemEnd.parent(".item-day")[0].classList.add("bg-time");
          } else if (LessonStartTime <= nowTime && nowTime <= LessonEndTime) {
            const fullTimeLesson = LessonEndTime - LessonStartTime;
            const realTimeLesson = nowTime - LessonStartTime;
            const persentRealTimeLesson = (realTimeLesson * 100) / fullTimeLesson;
            $("head").append(`<style>#less_${numLesson}:before{height:${persentRealTimeLesson}%;}</style>`);
          }
        }

        if (nowTime >= LessonFinalTime) {
          scrollToDay(nowIndexDay);
        } else {
          $.each(arrTime, (index, item) => {
            const itemStart = $(item).find("[id^='time_start']");
            const itemEnd = $(item).find("[id^='time_end']");

            endLessonToDay(itemStart, itemEnd, index + 1);
          });
        }

        // Найти начало первого урока
        function drowFirstLesson() {
          const itemFirstStart = $("#time_start_1");
          const [tfsh, tfsm] = $(itemFirstStart).html().split(":");
          const firstLessonStartTime = new Date().setHours(tfsh, tfsm, 0, 0);

          if (firstLessonStartTime >= nowTime) {
            itemFirstStart[0].classList.add("danger-animate");
          }
        }

        setTimeout(function () {
          location.reload();
        }, 300000);
      });
    </script>
  </body>
</html>
